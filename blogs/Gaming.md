写的前面都比较基础，后面有一些很鬼的题。

## SG函数

简单回顾一下$\mathrm{SG}$函数：

$\mathrm{SG}(S)=\mathrm{mex}\{\mathrm{SG}(T)\}$，其中$T$是$S$的后继局面。

局面的合并的$\mathrm{SG}$为所有局面的$\mathrm{SG}$函数的异或和。

$\mathrm{SG}$非零则先手胜，否则先手负。

## 套路

几个常见的Nim游戏套路：

-   无限制Nim游戏：$\mathrm{SG}(n)=n$
-   上限$k$的Nim游戏：$\mathrm{SG}(n)=n\bmod k$
-   每次从至多$k$堆取的Nim游戏：石子数转成二进制，如果每一位$1$的个数都是$k+1$的倍数那么后手胜
-   反Nim游戏（不能取的胜）：所有堆的石子数都为$1$且游戏的$\mathrm{SG}=0$，或者存在某个堆的石子数大于$1$且游戏的$\mathrm{SG}\ne 0$，那么先手胜

几个常见的分析套路：

-   打表法：暴力构建博弈树找寻$\mathrm{SG}$函数规律。


-   分治法：如果每次操作可以相当于把游戏划分为多个规模更小的游戏，那么可以$O(n^2)$递推
-   转换法：找寻问题的等价问题，划归为较简单的Nim游戏
-   决策分析：如果一个局面必胜，最好简单分析出一个方案使得无论对手怎么操作，都可以操作一次回到对手的一个必败局面

## 翻硬币问题

假设有$n$枚硬币排成一排，有的正面朝上，有的反面朝上。

游戏者根据某些约束翻硬币（如：每次只能翻一或两枚，或者每次只能翻连续的几枚），但他所翻动的硬币中，最右边的必须是从正面翻到反面，不能翻的人输。

那么局面的$\mathrm{SG}$值等于局面中每个正面朝上的棋子单一存在时的$\mathrm{SG}$值的异或和。

## 各种图的删边游戏

**以下游戏均要求复杂度$O(n)$。**

### 一般树上删边游戏

给定一棵有根树，每次删掉一条边，把不与根节点相连的部分删除。不能操作的人输。

解法：

考虑打表分析得到$\mathrm{SG}(u)=\bigotimes_{v} (\mathrm{SG}(v)+1)$，其中$v$是$u$的儿子。

很简单对吧。

### 圣诞树上删边游戏

定义一个圣诞树：在树上挂几个环，每一个环只与树有一个公共点，环与环之间无公共边。

仍然玩删边游戏。

解法：

对于长度为奇数的环，去掉一条边后得到两条长度同奇偶的链，$\mathrm{SG}$值异或后不可能是奇数，因此$\mathrm{SG}=1$。

对于长度为偶数的环，去掉一条边后得到两条长度异奇偶的链，$\mathrm{SG}$值异或后不可能是偶数，因此$\mathrm{SG}=0$。

还是很简单对吧。

### 仙人掌上删边游戏

现在要在仙人掌上玩删边游戏。

怎么做？？

解法：

考虑所有环下面的部分在缩环以后会变成啥样。

长度为偶数的环缩环后$\mathrm{SG}=0$，所以删去这个环并把剩余部分接上去，答案的$\mathrm{SG}$不变。

长度为奇数的环缩环后$\mathrm{SG}=1$，造一个新点接回去，然后发现下面的部分是直接影响上面的点的$\mathrm{SG}$，而不影响新点的值，则也接上去即可。

……仍然不难嘛

### 无向图上删边游戏

现在做无向图的删边游戏，如果删掉一条边后某部分和根不再联通则丢弃。

解法：

考虑把仙人掌的算法移植过来：

找寻每个简单环并缩掉，然后所有旧边都接回这个环的根，然后继续做。

可是复杂度是$O(n^2)$的。

使用融合原则可以得到偶数个点的边双会缩成一个点，奇数个点的边双缩掉以后会额外挂一个点。

用Tarjan算法即可。

## 动态减法游戏

### 1x 动态减法游戏

有一个整数$S$，两个人想让它变成$0$。首先，第一个人需要把$S$减掉一个数$x(0<x<S)$。之后双方轮流把$S$减掉一个正整数，但都不能超过先前一回合对方减掉的数，减到$0$的一方获胜。

问谁会获得胜利。

同时询问如果先手胜，**在第一次最小可以减掉多少**。

$50\%$做法：

我们发现$S$是奇数的时候只要第一个人选择减去$1$，那么他一定能赢。

这是一个优秀的$\ll50$分做法。

正经一点，$100\%$做法：

打表找规律，发现答案是$S=2^k$的时候后手必胜。

只需要考虑怎么证明：

首先如果$S\ne 2^k$，那么先手减去$\mathrm{lowbit}(S)<S$得到$T$，那么$T$在后$\log \mathrm{lowbit}(S)$位都为$0$，这样一来后手不能再次减去$\mathrm{lowbit}(T)$。因此后手会减去一个$\le \mathrm{lowbit}(S)<T$的数$U$，这时候由于$\mathrm{lowbit}(T-U)=\mathrm{lowbit}(U)\le U$，那么先手可以继续这么做下去直到减到$0$为止。同时因为后手每次减的数都不足剩余数，那么后手不可能胜。

接下来如果是$S=2^k$，那么操作方减去任何一个不足$S$的数都可以使得后手按照必胜策略继续操作下去，这样必败。

优秀的证明。

接下来考虑做二问。

显然先手胜的时候减去$\mathrm{lowbit}(S)$合法，同时减去一个小于$\mathrm{lowbit}(S)$的数时都又可以使得后手按照必胜策略继续操作下去，那么在第一次最小只能减小$\mathrm{lowbit}(S)$。

做完啦！很有趣对不对！

### 2x 动态减法游戏 

又有一个整数$S$，两个人想让它变成$0$。首先，第一个人需要把$S$减掉一个数$x(0<x<S)$。之后双方轮流把$S$减掉一个正整数，但都不能超过先前一回合对方减掉的数**的两倍**，减到$0$的一方获胜。

现在我连$50$分做法都不会了怎么办？？

打个表！发现答案竟是斐波那契数列的时候必败！

怎么证？考虑用上一个证法：

不是斐波那契数时，$S$一定可以拆成不少于$2$个不相邻的斐波那契数之和。定义斐波那契分解下的$\mathrm{fib\_lowbit}(S)$为分解出来的所有不相邻斐波那契数中最小的一个。同样的先手先减去$\mathrm{fib\_lowbit}(S)<S$得到$T$，那么$T$现在后$ \mathrm{fib\_lowbit}(S)+1$位都为$0$，这样一来后手不能再次减去$\mathrm{fib\_lowbit}(T)$（因为超过两倍）。因此后手会减去一个$\le 2\times \mathrm{fib\_lowbit}(S)<T$的数$U$，那么先手依然可以继续这么做下去直到减到$0$为止。同样的因为后手每次减的数都不足剩余数，那么后手不可能胜。

是斐波那契数的时候任意一个操作都使得后手可以按必胜法操作，必败。

简直有毒……

## 海盗分金

完了完了，蛇皮的一题……

#### 题面

有$n$个海盗来分$m$块金子。

海盗的编号是从$1$到$n$。从第$n$号海盗开始，他们会依次提出自己的分配方案。如果半数及以上的人（包括半数）赞成他的方案，则方案通过，开始分金子；否则方案不通过，海盗们就会把提出方案的那个人分尸吃掉，由下一个人继续提出方案。

海盗的原则：

先保证自己的生命安全，再想办法得到最多的金子，最后还要努力吃掉更多的人。

现在问对于每一个海盗，他能否活下去？如果能的话，他至少可能分到多少金子？

#### 海盗的逻辑分析

从两个人入手：

两个人时，$2$拿走所有$m$块金子，并且自己投自己，所以完结。

三个人时，$2$想的是只要$3$死了我就拿到所有而且不会死，那我怎么也不会投$3$。因此$3$为了保命只能收买$1$。$1$的想法是只要$3$死了我的收益就是$0$，那么只要$3$给我至少一个，我就投$3$。因此最终局面是$1$拿$1$个，$3$拿$m-1$个。

四个人时，$4$同样会选择去收买$3$个人时收益为$0$的$2$，并且也只需要给他$1$个。

……

#### 金子足够

如果金子足够，照如上的推理最后一个人为了保命，会拿出$1$收买所有奇偶性和他相同的人，因为这些人在少一个人的时候拿不到金子，现在一旦拿到，就会力挺最后一个人。

即使有第$2m+1$或者第$2m+2$个人，这个人也会为了保命把所有$m$块金子拿去收买人，虽然自己得不到金子。

#### 金子不够

现在假设人数多于$2m+2$，假设来了$2m+3$，由于$2m+1$和$2m+2$已经可以保命，那么他们本意就不会投$2m+3$，除非被收买，但$2m+3$只能额外收买$m$个人，他必死无疑。

假设来了$2m+4$，$2m+1$和$2m+2$仍然本意不投，$2m+3$知道$2m+4$一旦死掉自己也会死，所以无论如何都会投$2m+4$，加上$2m+4$自己的一票和收买的$m$的票就可以活下来。

接下来依次来了$2m+5\sim 2m+7$，但是由于前面的人都已经可以保命，而这$3$个人都不够票，所以都会死。

当来了$2m+8$的时候，收买的$m$票、不投就会死的$2m+5\sim 2m+7$的$3$票加上自己的票就足够票了。

那么这新来的$8$个又不会投票了（除非被收买），只有再等$8$个人来，下一个可以活下来的则是$2m+16$。

推到这里已经可以发现了，存活下来的是$2m+2^k$。

#### 关于至少分到数量

当金子足够，即$n\le 2m+1$，可以得到前面奇偶性相同的各拿$1$，最后一个拿走剩下的。

当金子不够，后面的人从$2m+2$个人开始都可以从前面所有人中任选$m$个收买，谁也不能保证自己拿到金子，最少分到数量都是$0$。

## 博弈论与匹配

两人轮流沿着边走，不允许重复访问节点，不能移动者输。

这是个经典问题（Undirected Vertex Geography）。

对于该问题有以下定理：

**起点 $v$ 是先手必胜的，当且仅当它在所有最大匹配上。**

具体例子可以看[LOJ Round #6](https://loj.ac/article/188)的T4。